{% extends 'base.html' %}

{% block content %}

{% comment %} <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script> {% endcomment %}

<div class="col-md-6 offset-md-3 mb-3" >
    <h2 class="text-center" >Adicionar Livro</h2>
    <hr>
    <form class="d-flex flex-column justify-content-center" method="POST" action="{% url 'add_book' %}" enctype="multipart/form-data" >

        {% csrf_token %}

        {{form.as_p}}

        {% comment %} <datalist id="year_choices" name="list-autocomplete"   >
            {% for year in year_choices %}
                <option class="form-control" value="{{ year }}"></option>
            {% endfor %}
        </datalist> {% endcomment %}

        {% comment %} <select id="year_choices" name="list-autocomplete"   >
            {% for year in year_choices %}
                <option class="form-control" value="{{ year }}"></option>
            {% endfor %}
        </select> {% endcomment %}

        
       
        <br/>
        <button type="submit" class="btn btn-success btn-lg mx-auto" style="width: 30%;"  >Adicionar</button>
    </form>

    

</div>

{% endblock %}



{% block scripts%}

    {% comment %} Script do select 2 para autocomplete {% endcomment %}
    
{% endblock %}

















{% comment %} try{
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method:'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'authorization':`Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        //model: "gpt-3.5-turbo",
                        model: "gpt-4o-mini",
                        messages:[
                            {role:"user", content: `Faça uma breve descrição do livro ${this.value} respeitando o limite maximo de 500 caracteres`}
                        ]
                    })

                })

                const data = await response.json()
                console.log("Resposta", data.choices[0].message.content)
                description.value = data.choices[0].message.content
            }
            catch(error){
                console.error("Erro", error)
            }    {% endcomment %}


{% comment %} import OpenAI from "openai"
        const openai = new OpenAI ({
            'apiKey':
            'sk-proj-VFIEPjeE08pO_GZMc4ith'
        }) {% endcomment %}




{% comment %} await fetch("https://api.openai.com/v1/responses", {
                method:'POST',
                headers: {
                    Accept: 'application/json',
                    'Content-Type': 'application/json',
                    //'authorization':`Bearer ${apiKey}`
                    Authorization: "Bearer " + apiKey,
                },
                body: JSON.stringify({
                    //model: "gpt-3.5-turbo",
                    //model: "gpt-4o-mini",
                    model: "text-davinci-003",
                    messages:[
                        {role:"user", content: `Faça uma breve descrição do livro ${this.value} respeitando o limite maximo de 500 caracteres`}
                    ]
                })

            })
            .then(response => 
                response.json()
            )
            .then(data => {
                console.log("Resposta", data.choices[0].message.content)
                //description.value = data.choices[0].message.content

                //console.log("Dados recebidos:", data);
                //if (data.choices && data.choices.length > 0) {
                //    description.value = data.choices[0].message.content;
                //} else {
                //    console.error("Resposta inesperada da API:", data);
                //}


            })
            .catch(error => {
                console.error("Erro", error)
            }) {% endcomment %}



{% comment %} fetch("https://api.openai.com/v1/responses", {
                method:'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'authorization':`Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    //model: "gpt-3.5-turbo",
                    model: "gpt-4o-mini",
                    messages:[
                        {role:"user", content: `Faça uma breve descrição do livro ${this.value} respeitando o limite maximo de 500 caracteres`}
                    ]
                })

            })
            .then(response => 
                response.json()
            )
            .then(data => {
                console.log("Resposta", data.choices[0].message.content)
                //description.value = data.choices[0].message.content

                //console.log("Dados recebidos:", data);
                //if (data.choices && data.choices.length > 0) {
                //    description.value = data.choices[0].message.content;
                //} else {
                //    console.error("Resposta inesperada da API:", data);
                //}


            })
            .catch(error => {
                console.error("Erro", error)
            })

        }) {% endcomment %}
        




{% comment %} <datalist id="year_choices">
    {% for value, display in form.year.field.choices %}
        <option value="{{ value }}">{{ display }}</option>
    {% endfor %}
</datalist> {% endcomment %}




 {% comment %} const completion = await openai.chat.completions.create({
                model: "gpt-4o-mini",
                messages:[
                    {role:"system", content:"você será uma assistente virtual que retornara informações uteis em portugues do Brasil"},
                    {role:"user", content: `Faça uma breve descrição do livro ${this.value} respeitando o limite maximo de 500 caracteres`},
                ]
                })
            }) {% endcomment %}